"use strict";!function(){jQuery(function(h){var e,g=null!=(e=window.wc_local_pickup_plus_frontend)?e:{},t=function(){return h(".wc-lpp-help-tip").each(function(){return h(this).tipTip({content:h(this).data("tip"),keepAlive:!0,edgeOffset:2})})},a=function(e){return!!e&&(e.is(".processing")||e.parents(".processing").length)},r=function(e){if(e&&!a(e))return e.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},l=function(e){if(e)return e.removeClass("processing").unblock()},i=function(){var a=h("form.woocommerce-cart-form, div.cart_totals"),i=h("#order_review");return h('input[name^="shipping_method"][type="radio"]').off("change.local-pickup-plus").on("change.local-pickup-plus",function(){var e,t;return r(a),r(i),e=h(this).is(":checked")&&"local_pickup_plus"===h(this).val()?"pickup":"ship",t=h(this).attr("data-index"),t={action:"wc_local_pickup_plus_set_package_items_handling",security:g.set_package_items_handling_nonce,package_id:t,handling:e},h.post({url:g.ajax_url,data:t}).done(function(e){return e&&e.success?g.is_cart?h(document.body).on("updated_shipping_method",function(){return h(document).trigger("wc_update_cart")}):g.is_checkout?(g.apply_pickup_location_tax&&h(document.body).one("updated_checkout",function(){return h(document.body).trigger("update_checkout")}),h(document.body).trigger("update_checkout")):void 0:console.log(e)}).always(function(){return l(a),l(i)})})},n=function(e){var t,a;return e.id?(a=t="",e.name&&e.address?(a=e.name,t=e.address):h(e.element)&&(a=h(e.element).data("name"),t=h(e.element).data("address")),""!==a?h('<div id="wc-local-pickup-plus-pickup-location-option-'+e.id+'" class="wc-local-pickup-plus-pickup-location-option"><span class="wc-location-pickup-plus-pickup-location-option-name" style="display:block;">'+a+'</span><small class="wc-location-pickup-plus-pickup-location-option-address" style="display:inline-block;">'+t+"</small></div>"):e.text):e.text||""},c=function(){var e;return h("a.enable-local-pickup, a.disable-local-pickup").on("click",function(e){var t,a,i,n,c,o;return e.preventDefault(),e=h(this).parent().parent(),t=h("form.woocommerce-cart-form, div.cart_totals"),a=h("#order_review"),h(this).hasClass("enable-local-pickup")?(c="pickup",e.find("a.enable-local-pickup").parent().hide(),e.find("a.disable-local-pickup").parent().show(),e.find("> div").show()):(c="ship",e.find("a.enable-local-pickup").parent().show(),e.find("a.disable-local-pickup").parent().hide(),e.find("> div").hide()),r(t),r(a),i=e.find(".pickup-location-lookup-area"),(o=(o=(n=e.find(".pickup-location-lookup")).attr("data-single-pickup-location"))&&0<parseInt(o,10)?o:n.val())||"per-order"!==g.pickup_selection_mode||(o=(n=h('[name="shipping_method_pickup_location_id[0]"]')).length?n.val():o),n={action:"wc_local_pickup_plus_set_cart_item_handling",security:g.set_cart_item_handling_nonce,cart_item_key:e.data("pickup-object-id"),pickup_data:{handling:c,lookup_area:i.val(),pickup_location_id:o}},h.post(g.ajax_url,n,function(e){return"per-order"===g.pickup_selection_mode&&h(".pickup-location-lookup").trigger("change"),l(t),l(a),e.success?g.is_cart?h(document).trigger("wc_update_cart"):g.is_checkout?h(document.body).trigger("update_checkout"):void 0:console.log(e)})}),h(".pickup-location-change-lookup-area").on("click",function(e){return e.preventDefault(),h(this).closest("div.pickup-location-lookup-area-field").find("> div").toggle()}),(e=h("select.pickup-location-lookup-area")).select2(),e.on("change",function(){var t,a,e,i,n,c=h(this).closest(".pickup-location-lookup-area-field").data("pickup-object-id"),o=h("#pickup-location-field-for-"+c).find("a.enable-local-pickup");if(!o.is(":visible")&&(o=h("#pickup-location-lookup-area-field-for-"+c).find("em.pickup-location-current-lookup-area-label"),i=h(this).select2("data"),t=h("form.woocommerce-cart-form, div.cart_totals"),a=h("#order_review"),i&&i[0]&&i[0].text&&o.text(i[0].text),r(t),r(a),i=(o=h("#pickup-location-field-for-"+c).find(".pickup-location-lookup")).data("pickup-object-type"),n=(n=o.attr("data-single-pickup-location"))&&0<parseInt(n,10)?n:o.val(),"cart-item"===i?e={action:"wc_local_pickup_plus_set_cart_item_handling",security:g.set_cart_item_handling_nonce,cart_item_key:c,pickup_data:{handling:"pickup",lookup_area:h(this).val(),pickup_location_id:n}}:"package"===i&&(o=h("#wc-local-pickup-plus-datepicker-"+c),e={action:"wc_local_pickup_plus_set_package_handling",security:g.set_package_handling_nonce,package_id:c,lookup_area:h(this).val(),pickup_location_id:n},o.length)&&o.val()&&(e.pickup_date=o.val()),e))return h.post(g.ajax_url,e,function(e){return l(t),l(a),e.success?g.is_cart?h(document).trigger("wc_update_cart"):g.is_checkout?h(document.body).trigger("update_checkout"):void 0:console.log(e)})})},o=function(){var t=function(e,t,a){var i,n;return e=e?e.toLowerCase():"",t=t?t.toLowerCase():"",n=!1,n=e&&!(n=t&&-1<t.indexOf(e)?!0:n)&&a&&(t=String(h(a.element).data("postcode")),i=h(a.element).data("city"),a=h(a.element).data("address"),!(n=!(n=t&&-1<t.toString().toLowerCase().indexOf(e)?!0:n)&&i&&-1<i.toString().toLowerCase().indexOf(e)?!0:n))&&a&&-1<a.toString().toLowerCase().indexOf(e)?!0:n},i=h("select.pickup-location-lookup"),a=i.closest("td").css("width");return g.use_enhanced_search?i.select2({initSelection:function(e,t){var a=e.val();return""!==a?(e={action:"wc_local_pickup_plus_get_pickup_location_name",security:g.get_pickup_location_name_nonce,id:a},h.post(g.ajax_url,e,function(e){if(e&&e.success&&e.data)return t({id:a,text:e.data})})):t({text:i.data("placeholder")})},minimumInputLength:2,language:{inputTooShort:function(){return g.i18n.search_type_minimum_characters},errorLoading:function(){return g.i18n.search_error_loading},loadingMore:function(){return g.i18n.search_loading_more},noResults:function(){return g.i18n.search_no_results},searching:function(){return g.i18n.search_searching}},templateResult:n,ajax:{url:g.ajax_url,cache:!1,dataType:"json",delay:250,data:function(e){var t=h(this).data("product-id"),a=h(this).data("pickup-object-id"),i=h(this).parent().find("#pickup-location-lookup-area-for-"+a);return{term:e.term,area:i?i.find("option:selected").val():"",cart_item_id:a,product_id:t,page:e.page,security:g.pickup_locations_lookup_nonce,action:"wc_local_pickup_plus_pickup_locations_lookup"}},processResults:function(e,t){e=e&&e.success&&e.data?e.data:[];return{results:e}}},width:a}):h.fn.select2.amd.require(["select2/compat/matcher"],function(e){return i.select2({templateResult:n,matcher:e(t),width:a})}),i.off("change.local-pickup-plus").on("change.local-pickup-plus",function(e){var t,a,i,n,c,o=h("form.woocommerce-cart-form, div.cart_totals"),p=h("#order_review");if(r(o),r(p),n=h(this).data("pickup-object-type"),c=h(this).data("pickup-object-id"),a=h(this).val(),i=h("#pickup-location-lookup-area-for-"+c).val(),"cart-item"===n?t={action:"wc_local_pickup_plus_set_cart_item_handling",security:g.set_cart_item_handling_nonce,cart_item_key:c,pickup_data:{handling:"pickup",lookup_area:i,pickup_location_id:a}}:"package"===n&&(t={action:"wc_local_pickup_plus_set_package_handling",security:g.set_package_handling_nonce,package_id:c,lookup_area:i,pickup_location_id:a}),t)return h.post(g.ajax_url,t,function(e){return l(o),l(p),e.success?g.is_cart?h(document).trigger("wc_update_cart"):g.is_checkout?h(document.body).trigger("update_checkout"):void 0:console.log(e)})})},p=function(){var e,t;if(!g.display_shipping_address_fields)return(t="per-item"===g.pickup_selection_mode?(e=parseInt(h("#wc-local-pickup-plus-packages-to-pickup").val(),10),parseInt(h("#wc-local-pickup-plus-packages-to-ship").val(),10)):(e=(t=h(".woocommerce-shipping-methods")).find("input[value=local_pickup_plus]:checked").length,t.find("input[type=radio]:checked").not("input[value=local_pickup_plus]").length))<e&&0===t?(h("#shiptobilling, #ship-to-different-address").hide(),h("#shiptobilling, #ship-to-different-address").parent().find("h3").hide(),h("#ship-to-different-address input").prop("checked",!1),h(".shipping_address").hide()):(h("#shiptobilling, #ship-to-different-address").show(),h("#shiptobilling, #ship-to-different-address").parent().find("h3").show(),h("#ship-to-different-address input").is(":checked")?h(".shipping_address").show():h(".shipping_address").hide())},u=function(){return h(".woocommerce-shipping-totals").each(function(){if("local_pickup_plus"===h(this).find("input.shipping_method:checked").val()||"local_pickup_plus"===h(this).find("input:hidden.shipping_method").val())return h(this).find("p.woocommerce-shipping-destination").hide(),h(this).find(".woocommerce-shipping-calculator").hide()})};return t(),i(),c(),o(),"undefined"!=typeof wc_cart_params&&u(),"undefined"!=typeof wc_checkout_params&&p(),h(document.body).on("updated_checkout",function(){var a=function(t,e){var i,n,a,c,o,p=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=t.find("input.pickup-location-appointment-date"),l=t.find("input.pickup-location-appointment-date-alt"),u=t.find("[id^=wc-local-pickup-plus-date-clear-]"),d=r.val(),s=r.data("location-id"),_=r.data("package-id"),d=""!==d?new Date(d):e.default_date&&""!==e.default_date?new Date(1e3*e.default_date):null,k=e.unavailable_dates?h.map(e.unavailable_dates,function(e){return e}):[];return p&&(r.attr("value",""),r.trigger("change"),r.removeClass("hasDatepicker"),r.datepicker("destroy")),p=new Date(1e3*e.calendar_start),a=new Date(1e3*e.calendar_end),p=new Date(p.getTime()+60*p.getTimezoneOffset()*1e3),a=new Date(a.getTime()+60*a.getTimezoneOffset()*1e3),d=new Date(d.getTime()+60*d.getTimezoneOffset()*1e3),r.datepicker({minDate:p,maxDate:a,altField:"#"+l.attr("id"),altFormat:"yy-mm-dd",dateFormat:g.date_format,defaultDate:d||null,firstDay:g.start_of_week,monthNames:g.month_names,dayNamesMin:g.day_initials,prevText:"",nextText:"",showOn:"both",buttonText:" ",gotoCurrent:!0,beforeShow:function(e,t){return h(t.dpDiv).addClass("pickup-location-appointment-datepicker").addClass("pickup-location-appointment-datepicker-"+_)},beforeShowDay:function(e){e=h.datepicker.formatDate("yy-mm-dd",e);return[-1===k.indexOf(e)]},onSelect:f}).one("init",function(e){return h("button.ui-datepicker-trigger").attr("title",g.i18n.datepicker_button)}).trigger("init"),i=null,n=c=o=0,r.on("keydown",function(e){var t,a;if(i&&null!==i&&0!==i.length||((t=(a=h(".pickup-location-appointment-datepicker-"+_).find(".ui-datepicker-calendar")).find(".ui-datepicker-current-day"))&&0!==t.length?i=t:(t=a.find("tbody tr td").not(".ui-datepicker-unselectable, .ui-state-disable").first(),(i=t)&&!i.hasClass("ui-datepicker-cursor")&&i.addClass("ui-datepicker-cursor"))),"ArrowLeft"===e.key?t=i.prevAll("td").not(".ui-datepicker-unselectable, .ui-state-disable").first():"ArrowRight"===e.key?t=i.nextAll("td").not(".ui-datepicker-unselectable, .ui-state-disable").first():"ArrowUp"===e.key?t=(t=i.parent("tr").prevAll("tr").first().find("td"))?t.not(".ui-datepicker-unselectable, .ui-state-disable").first():null:"ArrowDown"===e.key?t=(t=i.parent("tr").nextAll("tr").first().find("td"))?t.not(".ui-datepicker-unselectable, .ui-state-disable").first():null:"PageUp"===e.key||"PageDown"===e.key?(a=h(".pickup-location-appointment-datepicker-"+_).find(".ui-datepicker-calendar"),t="PageDown"===e.key?a?a.find("tbody tr td").not(".ui-datepicker-unselectable, .ui-state-disable").first():null:a?a.find("tbody tr td").not(".ui-datepicker-unselectable, .ui-state-disable").last():null):"Enter"===e.key&&0<o&&0<c&&0<n&&i.trigger("click"),t&&"selectDay"===t.data("handler")&&(e.preventDefault(),i.removeClass("ui-datepicker-cursor"),(i=t.first()).addClass("ui-datepicker-cursor"),o=parseInt(i.data("year"),10),c=parseInt(i.data("month"),10),n=parseInt(i.find("a").text(),10),0<o)&&0<c&&0<n)return h("#wc-local-pickup-plus-datepicker-"+_+"-live-region").html(h.datepicker.formatDate(g.date_format,new Date(o,c,n)))}),(p=t.find("select.pickup-location-appointment-offset")).select2(),p.on("change",function(e){return e.preventDefault(),e.stopPropagation(),f(h.datepicker.formatDate("yy-mm-dd",r.datepicker("getDate")),r)}),(l=(a=r.val())&&a.match(/^\d{4}-\d{2}-\d{2}$/)?h.datepicker.parseDate("yy-mm-dd",a):null)?(r.datepicker("setDate",l),h("#ui-datepicker-div").hide()):e.auto_select_default&&e.default_date&&""!==e.default_date&&(d=h.datepicker.parseDate("yy-mm-dd",e.default_date))&&(r.datepicker("setDate",d),h("#ui-datepicker-div").hide(),f(d,r)),u.on("click",function(e){return e.preventDefault(),r.datepicker("setDate",null),r.attr("value",""),e={action:"wc_local_pickup_plus_set_package_handling",security:g.set_package_handling_nonce,pickup_date:"",package_id:_,pickup_location_id:s},h.post(g.ajax_url,e,function(e){return e.success||console.log(e),t.find(".pickup-location-schedule").empty(),h(document.body).trigger("update_checkout")})})},f=function(e,t){var a,t=t.input||t,i=t.parent().parent(),n=t.data("location-id"),c=t.data("package-id"),o=h("#wc-local-pickup-plus-pickup-date-"+c).val(),p=h("#wc-local-pickup-plus-pickup-appointment-offset-"+c),r=p.val();if(e&&o&&new Date(o))return t.attr("value",e),a={action:"wc_local_pickup_plus_set_package_handling",security:g.set_package_handling_nonce,pickup_date:o,package_id:c,pickup_location_id:n,appointment_offset:r},h.post(g.ajax_url,a,function(e){return e.success||console.log(e),0===p.length?(a={action:"wc_local_pickup_plus_get_pickup_location_opening_hours_list",security:g.get_pickup_location_opening_hours_list_nonce,location:n,package_id:c,date:o},h.post(g.ajax_url,a,function(e){var t=i.find(".pickup-location-schedule");if(t.empty(),e&&e.success)return t.append(e.data),h(document.body).trigger("update_checkout")})):h(document.body).trigger("update_checkout")})},e=h(".pickup-location-appointment");return e&&e.each(function(){var t=h(this),e=t.find("input.pickup-location-appointment-date").data("location-id"),e={action:"wc_local_pickup_plus_get_pickup_location_appointment_data",security:g.get_pickup_location_appointment_data_nonce,location:e};return h.post(g.ajax_url,e,function(e){if(e.success)return a(t,e.data)})}),t(),i(),c(),o(),p(),h("#order_review").find("> p.woocommerce-shipping-contents").remove()}),h("#order_review").find("> p.woocommerce-shipping-contents").remove(),h(document.body).on("updated_cart_totals",function(){return t(),c(),o(),u()})})}.call(void 0);